HHrepID program for de novo protein repeat detection
Version 1.0.0 (November 2007)
(C) Andreas Biegert (see LICENSE file)

For bug reports, questions, or comments please contact johannes@soeding.com


1. Obtaining HHrepID and the databases
2. Getting started
3. HHrepID results

_______________________________________________________________________________________

1. Obtaining HHrepID

At ftp://ftp.tuebingen.mpg.de/pub/protevo/HHrepID/ binaries can be downloaded for 
* Linux x86 (32bit)
* Linux AMD64

From there you can also download the calibration database file 'cal.hhm' and data
files needed for the computation of repeat probabilities in HHrepID ('tp.dat' and 'fp.dat') 

_______________________________________________________________________________________

2. Getting started

2.1 Overview of programs:

  hhrepid        Detect repeats in a query alignment
  reformat.pl    Reformat one or many alignments
  buildali.pl    Build a PSI-BLAST alignment from a sequence or MSA, add sec. structure
  addpsipred.pl  Add predicted secondary structure to an alignment or a HMMER HMM
  alignhits.pl   Extract an alignment from a BLAST/PSI-BLAST output
  Align.pm       Perl package for local and global sequence-sequence alignment

Call a program without arguments (or with -h) to get a more detailed description of 
its syntax.


2.1. Building an alignment for your query sequence

Now suppose you want to search with the sequence of your favorite protein.
Hence you would like to create an alignment complete with predicted secondary
structure that you can then format into an HMM. (Predicted secondary structure is 
used in HHsearch as additional evidence for homology, hence it improves sensitivity 
to include it.) There is (a) a simple way and (b) a better way to do this. 

(a) The simpler way is to take the sequence of your favorite protein in FASTA and 
generate a multiple alignment with PSI-BLAST for it:
> blastpgp -i query.seq -d nr -j 5 -h 0.001 -o query.bla

It is advisable to open the alignment with an alignment editor (try, e.g. ALNEDITOR 
from the MPI webpage, ftp://ftp.tuebingen.mpg.de/pub/protevo/alndeit), to see if
PSI-BLAST has included non-homologous sequences or pieces of sequences into the 
alignment and purge the alignment if necessary.) Parse out the multiple alignment
with the provided BLAST parser alignhits.pl. For addpsipred.pl to work, you have to 
define the paths to your PSIPRED and BLAST directories at the top of the script.
> ./alignhits.pl query.bla query.a3m

The output file will be in A3M format by default, which looks misaligned, but it is 
not in fact. (See explications in section 4. To reconvert to FASTA, use './reformat.pl 
file.a3m file.fas'). Then add the PSIPRED secondary structure prediction to your query 
alignment (optional) with addpsipred.pl. For addpsipred.pl to work, you have to define 
the paths to your PSIPRED and BLAST  directories at the top of the script. Then type
 > ./addpsipred.pl query.a3m 

This includes two pseudo-sequences into your alignment, one containing the predicted
secondary structure states and the other containing the confidence values (0-9) for 
each match state. The output format is A3M. (To reconvert to FASTA, use 
'reformat.pl file.a3m file.fas'.)

(b) The better way uses the script buildali.pl from the HHsearch package. It builds 
an A3M alignment with iterated PSI-BLAST in a much more careful way. It checks after 
each round for each HSP (i.e. for each PSI-BLAST matched sequence fragment) if both its
ends have a sufficiently high score per column (e.g. 1/6 bits/column) with the query 
sequence, or rather with a 'core profile' of sequences most similar to the query. It 
prunes the HSP ends that do not have sufficient similarity, thus largely suppressing 
the frequent problem of profile corruption coming from the ends of domains, coiled 
coil regions, or low complexity regions. In a representative all-against-all benchmark 
on SCOP20, buildali.pl was able to reduce the number of high-scoring false-positives 
by a factor of approximately five, while only slightly reducing sensitivity for very 
remote homologs. Buildali.pl also automatically adds PSIPRED secondary structure 
prediction. 

To get buildali.pl to run you have to fill in a few paths at the top of the script, 
for example to the BLAST directory, PSIPRED data and binaries directories etc. Some of 
the same paths also have to be inserted at the top of the script alignhits.pl, which 
is called by buildali.pl. Finally, you need to have a non-redundant database like the 
nr from NCBI filtered to 90 and 70 percent (e.g. by using the program CD-HIT from 
Weizhong Lee, http://cd-hit.org/). You can call these databases nr90 and nr70, for 
example, and would set the $dbbase variable to "some_path/nr". The script then adds 
the "90" and "70" as needed. It will first search the nr90 until more than 50 
sequences are found, whence it will switch to the nr70. To test buildali.pl, you might 
as well set a link from the nr to nr90 and nr70, which means buildali.pl will search 
the entire nr (which is slower and a little less sensitive). Then start buildali.pl 
with your sequence:
> ./buildali.pl query.seq

If everything works, you will obtain an A3M-formatted alignment in file query.a3m 
as a result. (Make sure all paths are correct and your active shell is bash: 
> ln -s /bin/bash /bin/sh.)


2.3 Detecting repeats in your query alignment

After you have build an alignment you can use run hhrepid to look for repeats:

> ./hhrepid -i <query> -d <path to cal.hhm> -tp <path to tp.dat> -fp <path to fp.dat> 

Please note that in order to calculate repeat P-values and probabilities HHrepID 
requires that you specifiy paths to cal.hhm, tp.dat, and fp.dat. 

_______________________________________________________________________________________

3. HHrepID results

Below you can find HHrepID results for outer membrane protein A (OmpA).

Results for repeats type A:

Repeats        5
P-value  2.1E-07
Length        44
Offset        65

ID Probab  P-value RepScore RepScoreNorm Cols Query HMM Template HMM
A1  31.59  4.3e-03     2.57         0.23   11    7-17      91-101  
A2  79.71  9.9e-07    14.88         0.57   26   33-58      75-100  
A3  79.23  1.0e-03    17.89         0.41   44   65-108     65-108  
A4  85.70  2.6e-07    20.02         0.74   27  118-144     74-100  
A5  54.52  2.0e-05     6.04         0.43   14  157-170     74-87   

A1  1qjpA             7-17   +15 --------------------------WYTGAKLGWSQ-------yhdtglinnngpthe
A2  1qjpA            33-58    +6 ----------NKLGAGAFGGYQVNPYVGFEMGYDWL--------grmpyk.........
A3  1qjpA            65-108   +9 GSVENGAYKAQGVQLTAKLGYPITDDLDIYTRLGGMVWRADTYSnvygknhdt......
A4  1qjpA           118-144  +12 ---------GVSPVFAGGVEYAITPEIATRLEYQWT--------nnigdahtigtr...
A5  1qjpA           157-170   +0 ---------PDNGMLSLGVSYRF---------------------...............



Repeat type overview

For each type of detected repeats HHrepID displays an overview table with information
about the group of repeat that have been found together.

Repeats        5
P-value  2.1E-07
Length        44
Offset        65


Summary hit list

For each type of detected repeats HHrepID displays a summary hit list.

ID Probab  P-value RepScore RepScoreNorm Cols Query HMM Template HMM
A1  31.59  4.3e-03     2.57         0.23   11    7-17      91-101  
A2  79.71  9.9e-07    14.88         0.57   26   33-58      75-100  
A3  79.23  1.0e-03    17.89         0.41   44   65-108     65-108  
A4  85.70  2.6e-07    20.02         0.74   27  118-144     74-100  
A5  54.52  2.0e-05     6.04         0.43   14  157-170     74-87   
 
The meaning of the columns in the hit list is the following:

Column 1 'No':            Index of hit

Column 2 'Prob':          Probability of target to be a true positive

Column 3 'P-value':       P-value

Column 4 'RepScore':      Sum of posterior probabilities of Match columns along MAC
                          path.

Column 5 'RepScoreNorm':  Sum of posterior probabilities of Match columns along MAC
                          path normalized by the length of the repeat unit.

Column 6 'Cols':          The number of aligned Match columns in the HMM-HMM alignment.

Column 7 'Query HMM':     Aligned region in query HMM.

Column 8 'Template HMM':  Aligned region in template HMM.


Repeat alignment

For each type of detected repeats HHrepID displays an alignment of the detectedd repeats.

A1  1qjpA             7-17   +15 --------------------------WYTGAKLGWSQ-------yhdtglinnngpthe
A2  1qjpA            33-58    +6 ----------NKLGAGAFGGYQVNPYVGFEMGYDWL--------grmpyk.........
A3  1qjpA            65-108   +9 GSVENGAYKAQGVQLTAKLGYPITDDLDIYTRLGGMVWRADTYSnvygknhdt......
A4  1qjpA           118-144  +12 ---------GVSPVFAGGVEYAITPEIATRLEYQWT--------nnigdahtigtr...
A5  1qjpA           157-170   +0 ---------PDNGMLSLGVSYRF---------------------...............

The format of the repeat alignment is A2M, that is aligned regions are written in upper
case, inserts are written in lower case. HHrepID also gives start and end position of
each repeats as well as the length of the unaligned region between repeat units.



Good luck with your work!

Andreas Biegert

biegert@lmb.uni-muenchen.de

